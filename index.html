<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>Birthday Gift</title>
  <style>
    :root{
      --bg1:#1a0f2e;
      --bg2:#2b1446;
      --bg3:#0f1b3a;

      --paper1:#ffffff;
      --paper2:#f6f1ff;

      --shadow: 0 20px 55px rgba(0,0,0,.35);
      --shadow-soft: 0 10px 25px rgba(0,0,0,.25);
      --glow: 0 0 0 1px rgba(255,255,255,.08), 0 10px 30px rgba(255,120,200,.14);

      --accent1:#ff6fb7;
      --accent2:#ffb3d9;
      --accent3:#a7f0ff;

      --box1:#ff5aa3;
      --box2:#ff86c0;
      --lid1:#ff4f98;
      --lid2:#ff7ab7;
      --ribbon:#ffe6f3;
      --ribbon2:#fff5fb;

      --gold1:#f9d47f;
      --gold2:#b8862b;

      --card1:#121423;
      --card2:#1b2040;

      --radius: 22px;
      --t: 420ms;
      --t2: 760ms;
      --ease: cubic-bezier(.2,.9,.2,1);
    }

    *{ box-sizing:border-box; }
    html,body{ height:100%; }
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
      color:#fff;
      background:
        radial-gradient(1200px 900px at 15% 15%, rgba(255,111,183,.22), transparent 60%),
        radial-gradient(900px 700px at 85% 35%, rgba(167,240,255,.18), transparent 60%),
        radial-gradient(1100px 900px at 50% 90%, rgba(170,120,255,.16), transparent 60%),
        linear-gradient(140deg, var(--bg1), var(--bg2) 45%, var(--bg3));
      overflow:hidden;
    }

    /* Floating hearts (pure CSS) */
    .hearts{
      position:fixed; inset:0;
      pointer-events:none;
      opacity:.9;
      filter: drop-shadow(0 10px 10px rgba(0,0,0,.25));
    }
    .heart{
      position:absolute;
      width:14px; height:14px;
      transform: rotate(45deg);
      background: radial-gradient(circle at 30% 30%, rgba(255,255,255,.75), rgba(255,255,255,0) 45%),
                  linear-gradient(140deg, rgba(255,111,183,.95), rgba(255,179,217,.65));
      border-radius: 3px;
      animation: floatUp linear infinite;
      opacity:.35;
    }
    .heart::before,.heart::after{
      content:"";
      position:absolute;
      width:14px;height:14px;
      border-radius:50%;
      background: inherit;
    }
    .heart::before{ left:-7px; top:0; }
    .heart::after{ top:-7px; left:0; }
    @keyframes floatUp{
      from{ transform: translate3d(0, 14vh, 0) rotate(45deg) scale(.9); }
      to  { transform: translate3d(0,-120vh,0) rotate(45deg) scale(1.2); }
    }

    .wrap{
      position:relative;
      height:100%;
      display:grid;
      place-items:center;
      padding: clamp(16px, 3.5vw, 34px);
    }

    .stage{
      position:relative;
      width:min(760px, 100%);
      height:min(680px, 100%);
      display:grid;
      place-items:center;
    }

    .ambient{
      position:absolute;
      width:min(680px, 92vw);
      height:min(680px, 92vw);
      border-radius:50%;
      background:
        radial-gradient(circle at 50% 35%, rgba(255,255,255,.15), rgba(255,255,255,0) 55%),
        radial-gradient(circle at 40% 70%, rgba(255,111,183,.18), rgba(255,111,183,0) 62%),
        radial-gradient(circle at 70% 65%, rgba(167,240,255,.12), rgba(167,240,255,0) 60%);
      filter: blur(2px);
      opacity:.9;
      transform: translate3d(0, 24px, 0);
    }

    .hint{
      position:absolute;
      top: clamp(10px, 2.2vh, 18px);
      left:50%;
      transform: translateX(-50%);
      width: min(560px, 92%);
      text-align:center;
      font-size: clamp(14px, 1.8vw, 16px);
      line-height:1.25;
      color: rgba(255,255,255,.86);
      padding: 12px 14px;
      border-radius: 999px;
      background: rgba(255,255,255,.06);
      box-shadow: 0 0 0 1px rgba(255,255,255,.08), 0 16px 40px rgba(0,0,0,.25);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      user-select:none;
    }
    .hint b{ color:#fff; font-weight:700; }

    /* Gift box */
    .gift-zone{
      position:relative;
      width:min(420px, 78vw);
      height:min(380px, 62vh);
      display:grid;
      place-items:end center;
      padding-bottom: clamp(26px, 4vh, 46px);
      z-index:2;
    }

    /* Big clickable area */
    .hit{
      position:absolute;
      inset:-20%;
      border-radius: 28px;
      background: transparent;
      cursor: pointer;
      -webkit-tap-highlight-color: transparent;
      touch-action: manipulation;
    }

    .gift{
      position:relative;
      width: min(320px, 64vw);
      height: min(260px, 44vw);
      transform: translateZ(0);
      filter: drop-shadow(0 26px 36px rgba(0,0,0,.38));
      will-change: transform, filter, opacity;
    }

    .base{
      position:absolute;
      left:0; right:0;
      bottom:0;
      height: 68%;
      border-radius: 18px;
      background:
        radial-gradient(140px 90px at 25% 25%, rgba(255,255,255,.30), rgba(255,255,255,0) 70%),
        linear-gradient(160deg, var(--box2), var(--box1));
      box-shadow: var(--shadow), var(--glow);
      overflow:hidden;
    }

    .base::after{
      content:"";
      position:absolute; inset:0;
      background:
        linear-gradient(0deg, rgba(0,0,0,.10), transparent 45%),
        radial-gradient(200px 140px at 70% 15%, rgba(255,255,255,.22), rgba(255,255,255,0) 65%);
      opacity:.85;
      pointer-events:none;
    }

    .lid{
      position:absolute;
      left:-3%;
      right:-3%;
      top: 22%;
      height: 30%;
      border-radius: 18px;
      background:
        radial-gradient(120px 70px at 25% 35%, rgba(255,255,255,.32), rgba(255,255,255,0) 70%),
        linear-gradient(160deg, var(--lid2), var(--lid1));
      box-shadow: 0 16px 30px rgba(0,0,0,.22), 0 0 0 1px rgba(255,255,255,.08);
      transform-origin: 50% 95%;
      transform: translateY(0) rotateX(0deg);
      transition: transform var(--t2) var(--ease), filter var(--t) var(--ease), opacity var(--t) var(--ease);
      overflow:hidden;
    }

    .lid::after{
      content:"";
      position:absolute; inset:0;
      background:
        linear-gradient(0deg, rgba(0,0,0,.12), transparent 55%),
        radial-gradient(220px 130px at 70% 20%, rgba(255,255,255,.18), rgba(255,255,255,0) 62%);
      opacity:.9;
    }

    /* Ribbons */
    .ribbonV, .ribbonH{
      position:absolute;
      pointer-events:none;
      transition: opacity var(--t2) var(--ease), transform var(--t2) var(--ease), filter var(--t) var(--ease);
      will-change: opacity, transform;
    }
    .ribbonV{
      top: 18%;
      left: 50%;
      transform: translateX(-50%);
      width: 12%;
      height: 82%;
      background:
        linear-gradient(180deg, rgba(255,255,255,.55), rgba(255,255,255,.25)),
        linear-gradient(180deg, var(--ribbon), var(--ribbon2));
      border-radius: 12px;
      box-shadow: inset 0 0 0 1px rgba(255,255,255,.35);
      opacity:.95;
      filter: drop-shadow(0 10px 16px rgba(0,0,0,.20));
    }
    .ribbonH{
      left: 4%;
      right: 4%;
      top: 52%;
      height: 12%;
      background:
        linear-gradient(180deg, rgba(255,255,255,.55), rgba(255,255,255,.22)),
        linear-gradient(180deg, var(--ribbon), var(--ribbon2));
      border-radius: 12px;
      box-shadow: inset 0 0 0 1px rgba(255,255,255,.35);
      opacity:.95;
      filter: drop-shadow(0 10px 16px rgba(0,0,0,.18));
    }

    /* Bow */
    .bow{
      position:absolute;
      top: 10%;
      left: 50%;
      transform: translateX(-50%);
      width: 46%;
      height: 26%;
      pointer-events:none;
      transition: opacity var(--t2) var(--ease), transform var(--t2) var(--ease), filter var(--t) var(--ease);
      opacity:1;
      filter: drop-shadow(0 16px 22px rgba(0,0,0,.20));
      will-change: opacity, transform;
    }
    .bow .loop{
      position:absolute;
      top: 10%;
      width: 48%;
      height: 68%;
      border-radius: 999px;
      background:
        radial-gradient(60px 40px at 35% 35%, rgba(255,255,255,.35), rgba(255,255,255,0) 70%),
        linear-gradient(160deg, rgba(255,255,255,.65), rgba(255,255,255,.15)),
        linear-gradient(160deg, var(--ribbon2), var(--ribbon));
      box-shadow: inset 0 0 0 1px rgba(255,255,255,.45);
    }
    .bow .loop.left{ left:0; transform: rotate(-16deg); }
    .bow .loop.right{ right:0; transform: rotate(16deg); }
    .bow .knot{
      position:absolute;
      left:50%; top: 36%;
      width: 20%;
      height: 40%;
      transform: translateX(-50%);
      border-radius: 14px;
      background:
        radial-gradient(30px 22px at 35% 35%, rgba(255,255,255,.35), rgba(255,255,255,0) 70%),
        linear-gradient(160deg, rgba(255,255,255,.55), rgba(255,255,255,.12)),
        linear-gradient(160deg, var(--ribbon2), var(--ribbon));
      box-shadow: inset 0 0 0 1px rgba(255,255,255,.45);
    }
    .bow .tail{
      position:absolute;
      top: 68%;
      width: 18%;
      height: 50%;
      border-radius: 12px;
      background:
        linear-gradient(180deg, rgba(255,255,255,.55), rgba(255,255,255,.18)),
        linear-gradient(160deg, var(--ribbon2), var(--ribbon));
      box-shadow: inset 0 0 0 1px rgba(255,255,255,.40);
      clip-path: polygon(0 0, 100% 0, 100% 85%, 50% 100%, 0 85%);
      opacity:.95;
    }
    .bow .tail.left{ left: 30%; transform: rotate(-8deg); }
    .bow .tail.right{ right: 30%; transform: rotate(8deg); }

    /* Unwrap micro animations */
    .gift.wobble-1{ animation: wobble1 450ms var(--ease) 1; }
    .gift.wobble-2{ animation: wobble2 520ms var(--ease) 1; }
    .gift.wobble-3{ animation: wobble3 560ms var(--ease) 1; }
    @keyframes wobble1{
      0%{ transform: translate3d(0,0,0) rotate(0deg); }
      35%{ transform: translate3d(0,-2px,0) rotate(-1.2deg); }
      70%{ transform: translate3d(0,1px,0) rotate(1.1deg); }
      100%{ transform: translate3d(0,0,0) rotate(0deg); }
    }
    @keyframes wobble2{
      0%{ transform: translate3d(0,0,0) rotate(0deg); }
      25%{ transform: translate3d(-1px,-3px,0) rotate(1.6deg); }
      55%{ transform: translate3d(1px,2px,0) rotate(-1.3deg); }
      100%{ transform: translate3d(0,0,0) rotate(0deg); }
    }
    @keyframes wobble3{
      0%{ transform: translate3d(0,0,0) rotate(0deg); }
      20%{ transform: translate3d(2px,-4px,0) rotate(-2deg); }
      55%{ transform: translate3d(-2px,3px,0) rotate(1.6deg); }
      100%{ transform: translate3d(0,0,0) rotate(0deg); }
    }

    .gift.open .lid{
      transform: translateY(-10%) rotateX(65deg);
      filter: drop-shadow(0 18px 18px rgba(0,0,0,.18));
    }

    .fade-out{
      opacity:0 !important;
      transform: translate3d(0,-6px,0) scale(.98) !important;
      filter: blur(1px) !important;
    }

    /* Postcard */
    .postcard-wrap{
      position:absolute;
      left:50%;
      bottom: clamp(32px, 6vh, 62px);
      transform: translateX(-50%);
      width: min(520px, 88vw);
      height: auto;
      pointer-events:none;
      opacity:0;
      z-index:4;
      will-change: transform, opacity;
    }
    .postcard-wrap.reveal{
      pointer-events:auto;
      opacity:1;
      animation: cardRise 980ms var(--ease) 1 forwards;
    }
    @keyframes cardRise{
      0%{ transform: translateX(-50%) translateY(120px) scale(.94); }
      55%{ transform: translateX(-50%) translateY(-20px) scale(1.02); }
      100%{ transform: translateX(-50%) translateY(-86px) scale(1.00); }
    }

    .postcard{
      width:100%; height:100%;
      position:relative;
      transform-style: preserve-3d;
      transition: transform 900ms cubic-bezier(.2,.8,.15,1);
      cursor:pointer;
      border-radius: var(--radius);
      box-shadow: var(--shadow), 0 0 0 1px rgba(255,255,255,.10);
      -webkit-tap-highlight-color: transparent;
      user-select:none;
    }
    .postcard.flipped{ transform: rotateY(180deg); }

    .side{
      position:absolute;
      inset:0;
      border-radius: var(--radius);
      backface-visibility: hidden;
      overflow:hidden;
    }
    .front{
      background:
        radial-gradient(300px 220px at 25% 25%, rgba(255,255,255,.95), rgba(255,255,255,.0) 70%),
        linear-gradient(160deg, var(--paper1), var(--paper2));
      color: rgba(15,16,22,.92);
    }
    .front::after{
      content:"";
      position:absolute; inset:0;
      background:
        radial-gradient(260px 180px at 85% 20%, rgba(255,111,183,.12), rgba(255,111,183,0) 65%),
        radial-gradient(260px 180px at 15% 85%, rgba(167,240,255,.10), rgba(167,240,255,0) 65%),
        linear-gradient(0deg, rgba(0,0,0,.04), transparent 55%);
      pointer-events:none;
    }
    .front .content{
      position:relative;
      height:100%;
      padding: clamp(18px, 3.2vw, 28px);
      display:flex;
      flex-direction:column;
      justify-content:center;
      gap: 12px;
    }
    .front .title{
      font-size: clamp(18px, 2.7vw, 22px);
      letter-spacing:.2px;
      font-weight: 750;
      color: rgba(22,18,32,.92);
    }
    .front .msg{
      font-size: clamp(16px, 2.6vw, 20px);
      line-height:1.4;
      color: rgba(22,18,32,.86);
      max-width: 36ch;
    }
    .front .sig{
      margin-top: 6px;
      font-size: clamp(14px, 2.2vw, 16px);
      color: rgba(22,18,32,.70);
      font-weight:600;
    }
    .front .mini{
      position:absolute;
      right: clamp(14px, 2.6vw, 22px);
      bottom: clamp(14px, 2.6vw, 20px);
      font-size: 12px;
      color: rgba(22,18,32,.52);
      background: rgba(0,0,0,.04);
      padding: 8px 10px;
      border-radius: 999px;
      box-shadow: 0 0 0 1px rgba(0,0,0,.05);
    }

    .back{
      transform: rotateY(180deg);
      background:
        radial-gradient(320px 240px at 20% 20%, rgba(255,255,255,.10), rgba(255,255,255,0) 68%),
        linear-gradient(160deg, rgba(255,255,255,.06), rgba(255,255,255,.02));
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      display:grid;
      place-items:center;
      padding: clamp(14px, 2.6vw, 20px);
    }

    /* Gift card on back */
    .giftcard{
      width: min(420px, 88%);
      height: auto;
      border-radius: 18px;
      background:
        radial-gradient(200px 140px at 25% 20%, rgba(255,255,255,.18), rgba(255,255,255,0) 65%),
        radial-gradient(220px 160px at 85% 80%, rgba(255,111,183,.18), rgba(255,111,183,0) 65%),
        linear-gradient(160deg, var(--card2), var(--card1));
      box-shadow: var(--shadow-soft), 0 0 0 1px rgba(255,255,255,.10);
      padding: 16px 16px 14px;
      display:flex;
      flex-direction:column;
      gap: 10px;
      position:relative;
      overflow:hidden;
    }
    .giftcard::after{
      content:"";
      position:absolute; inset:-2px;
      background:
        radial-gradient(260px 180px at 65% 20%, rgba(167,240,255,.14), rgba(167,240,255,0) 60%),
        linear-gradient(0deg, rgba(0,0,0,.18), transparent 55%);
      pointer-events:none;
      opacity:.9;
    }

    .giftcard-top{
      position:relative;
      display:flex;
      align-items:center;
      justify-content:space-between;
      z-index:1;
    }
    .brand{
      display:flex; align-items:center; gap:10px;
      font-weight:800;
      letter-spacing:.3px;
    }
    .chip{
      width: 38px; height: 28px;
      border-radius: 8px;
      background: linear-gradient(160deg, rgba(255,255,255,.20), rgba(255,255,255,.06));
      box-shadow: inset 0 0 0 1px rgba(255,255,255,.22);
      position:relative;
    }
    .chip::before,.chip::after{
      content:"";
      position:absolute; inset:6px;
      border-radius: 6px;
      box-shadow: inset 0 0 0 1px rgba(255,255,255,.18);
      opacity:.7;
    }
    .chip::after{
      inset: 10px 6px;
      border-radius: 999px;
      opacity:.45;
    }
    .spark{
      width: 34px; height: 34px;
      border-radius: 12px;
      background: radial-gradient(circle at 30% 30%, rgba(255,255,255,.20), rgba(255,255,255,0) 70%),
                  linear-gradient(160deg, rgba(255,111,183,.35), rgba(167,240,255,.20));
      box-shadow: inset 0 0 0 1px rgba(255,255,255,.14);
      opacity:.9;
    }

    .scratch-instructions{
      position:relative;
      z-index:1;
      font-size: 13px;
      color: rgba(255,255,255,.86);
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 10px;
      margin-top: 2px;
    }
    .scratch-instructions .label{
      font-weight:700;
      letter-spacing:.2px;
    }
    .scratch-instructions .pct{
      font-variant-numeric: tabular-nums;
      color: rgba(255,255,255,.78);
      background: rgba(255,255,255,.08);
      padding: 6px 10px;
      border-radius: 999px;
      box-shadow: 0 0 0 1px rgba(255,255,255,.10);
      white-space:nowrap;
    }

    .scratch-zone{
      position:relative;
      flex:1;
      border-radius: 16px;
      background: rgba(255,255,255,.06);
      box-shadow: inset 0 0 0 1px rgba(255,255,255,.10);
      overflow:hidden;
      z-index:1;
      touch-action:none; /* critical for mobile drawing */
    }

    /* Amount layer (inside scratch area) */
    .amount-layer{
      position:absolute;
      inset:0;
      display:grid;
      place-items:center;
      padding: 14px;
      pointer-events:none;
    }
    .amount-text{
      font-size: clamp(10px, 2.2vw, 16px);
      font-weight: 800;
      letter-spacing: .15px;
      line-height: 1.25;
      text-align: center;
      max-width: 90%;
      padding: 0 8px;
      word-wrap: break-word;
      white-space: normal;
      color: rgba(255,255,255,.92);
      text-shadow: 0 8px 22px rgba(0,0,0,.35);
      filter: blur(14px);
      opacity: .38;
      transition: filter 520ms cubic-bezier(.2,.9,.2,1),opacity 520ms cubic-bezier(.2,.9,.2,1);
      overflow: hidden;

    }
    .amount-text.unlocked{
      filter: blur(0px);
      opacity: 1;
      transform: scale(1.02);
    }

    /* Canvas scratch cover sits on top */
    #scratchCanvas{
      position:absolute;
      inset:0;
      width:100%;
      height:100%;
      border-radius: 16px;
      display:block;
    }

    /* Coin cursor overlay */
    .coin{
      position:fixed;
      width: 44px;
      height: 44px;
      border-radius: 50%;
      pointer-events:none;
      transform: translate3d(-999px,-999px,0);
      z-index: 9999;
      opacity: 0;
      transition: opacity 160ms ease;
      filter: drop-shadow(0 14px 18px rgba(0,0,0,.35));
    }
    .coin::before{
      content:"";
      position:absolute; inset:0;
      border-radius: 50%;
      background:
        radial-gradient(circle at 30% 28%, rgba(255,255,255,.55), rgba(255,255,255,0) 45%),
        linear-gradient(160deg, var(--gold1), var(--gold2));
      box-shadow: inset 0 0 0 2px rgba(255,255,255,.22), inset 0 -10px 18px rgba(0,0,0,.20);
    }
    .coin::after{
      content:"";
      position:absolute;
      inset: 9px;
      border-radius: 50%;
      box-shadow: inset 0 0 0 2px rgba(255,255,255,.22);
      opacity:.55;
    }
    .coin.show{ opacity:1; }

    /* Dim/blur box after card emerges */
    .gift-zone.dim .gift{
      opacity: .35;
      filter: blur(2px) drop-shadow(0 22px 28px rgba(0,0,0,.26));
      transform: scale(.98);
      transition: opacity 520ms var(--ease), filter 520ms var(--ease), transform 520ms var(--ease);
    }

    /* Confetti */
    .confetti{
      position:absolute;
      inset:-20px -10px -10px -10px;
      pointer-events:none;
      opacity:0;
      transition: opacity 240ms ease;
      z-index: 10;
    }
    .confetti.on{ opacity:1; }
    .confetti i{
      position:absolute;
      width: 10px;
      height: 18px;
      border-radius: 4px;
      opacity:.95;
      transform: translate3d(0,-20px,0) rotate(0deg);
      animation: confettiFall 1100ms cubic-bezier(.12,.8,.2,1) forwards;
      box-shadow: 0 12px 24px rgba(0,0,0,.25);
      background:
        radial-gradient(circle at 30% 30%, rgba(255,255,255,.35), rgba(255,255,255,0) 55%),
        linear-gradient(160deg, rgba(255,111,183,.95), rgba(167,240,255,.55));
    }
    @keyframes confettiFall{
      0%{ transform: translate3d(var(--x), -24px, 0) rotate(0deg); opacity:0; }
      12%{ opacity:1; }
      100%{ transform: translate3d(calc(var(--x) * 1.2), calc(100% + 220px), 0) rotate(460deg); opacity:0; }
    }

    /* Responsive tune */
    @media (max-width: 420px){
      .hint{ border-radius: 18px; }
      .front .mini{ display:none; }
      .giftcard{ padding: 14px 14px 12px; }
      .coin{ width:40px; height:40px; }
    }

    /* Reduce motion */
    @media (prefers-reduced-motion: reduce){
      .heart{ animation-duration: 18s !important; }
      .gift.wobble-1,.gift.wobble-2,.gift.wobble-3{ animation:none !important; }
      .postcard-wrap.reveal{ animation:none !important; transform: translateX(-50%) translateY(-86px) scale(1); opacity:1; }
      .postcard{ transition:none !important; }
      .lid{ transition:none !important; }
      .ribbonV,.ribbonH,.bow{ transition:none !important; }
    }
  </style>
</head>
<body>
  <div class="hearts" aria-hidden="true" id="hearts"></div>

  <div class="wrap">
    <div class="stage">
      <div class="ambient" aria-hidden="true"></div>

      <div class="hint" id="hint">
        Tap the gift gently‚Ä¶ <b>multiple times</b>.
      </div>

      <div class="gift-zone" id="giftZone">
        <div class="hit" id="hit" aria-label="Open gift"></div>

        <div class="gift" id="gift">
          <div class="lid" id="lid"></div>

          <div class="bow" id="bow" aria-hidden="true">
            <div class="loop left"></div>
            <div class="loop right"></div>
            <div class="knot"></div>
            <div class="tail left"></div>
            <div class="tail right"></div>
          </div>

          <div class="ribbonV" id="ribbonV" aria-hidden="true"></div>
          <div class="ribbonH" id="ribbonH" aria-hidden="true"></div>

          <div class="base" aria-hidden="true"></div>
        </div>
      </div>

      <div class="postcard-wrap" id="postcardWrap">
        <div class="postcard" id="postcard" role="button" aria-label="Flip postcard" tabindex="0">
          <div class="side front">
            <div class="content">
              <div class="title" id="frontTitle">Happy Birthday Toma ‚ù§Ô∏è</div>
              <div class="msg" id="frontMsg"></div>
              <div class="sig" id="frontSig">With love ‚ù§Ô∏è</div>
              <div class="mini">Tap to flip</div>
            </div>
          </div>

          <div class="side back">
            <div class="giftcard">
              <div class="giftcard-top">
                <div class="brand">
                  <div class="chip" aria-hidden="true"></div>
                  <div>Gift Card</div>
                </div>
                <div class="spark" aria-hidden="true"></div>
              </div>

              <div class="scratch-instructions">
                <div class="label" id="scratchLabel">Scratch to reveal your gift</div>
                <div class="pct" id="scratchPct">0%</div>
              </div>

              <div class="scratch-zone" id="scratchZone">
                <div class="amount-layer" aria-hidden="true">
                  <div class="amount-text" id="amountText"></div>
                </div>
                <canvas id="scratchCanvas"></canvas>

                <div class="confetti" id="confetti" aria-hidden="true"></div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="coin" id="coin" aria-hidden="true"></div>
    </div>
  </div>

  <script>
    const CONFIG = {
      birthdayMessageFront: "Happy birthday ‚ù§Ô∏è, I wish you a lot of success in the upcoming year and that you will get everything you deserve, a little gift for you on the back of the card, Love.‚ù§Ô∏è",
      giftAmount: "100$ That will go towards your debt, will drop it to 1100$ and another 100$ that will be sent to you to spend.‚ù§Ô∏è",
      scratchUnlockThreshold: 1.00,
      unwrapClicks: 10, // 8 to 12 recommended
      scratchRadius: 10, // smaller = harder/slower
      scratchHardness: 1.0 // multiplier (>=1.0 makes it slower by reducing effective sampling progress)
    };

    // ---------- Floating hearts ----------
    (function buildHearts(){
      const hearts = document.getElementById("hearts");
      const count = 22;
      for(let i=0;i<count;i++){
        const h = document.createElement("div");
        h.className = "heart";
        const left = Math.random()*100;
        const size = 10 + Math.random()*16;
        const dur = 10 + Math.random()*16;
        const delay = -Math.random()*dur;
        const opacity = 0.18 + Math.random()*0.30;
        h.style.left = left + "vw";
        h.style.bottom = (-10 - Math.random()*30) + "vh";
        h.style.width = size + "px";
        h.style.height = size + "px";
        h.style.animationDuration = dur + "s";
        h.style.animationDelay = delay + "s";
        h.style.opacity = opacity.toFixed(2);
        hearts.appendChild(h);
      }
    })();

    // ---------- Gift unwrapping ----------
    const hit = document.getElementById("hit");
    const gift = document.getElementById("gift");
    const bow = document.getElementById("bow");
    const ribbonV = document.getElementById("ribbonV");
    const ribbonH = document.getElementById("ribbonH");
    const hint = document.getElementById("hint");
    const giftZone = document.getElementById("giftZone");

    const postcardWrap = document.getElementById("postcardWrap");
    const postcard = document.getElementById("postcard");
    const frontMsg = document.getElementById("frontMsg");
    const amountText = document.getElementById("amountText");

    frontMsg.textContent = CONFIG.birthdayMessageFront;
    amountText.textContent = CONFIG.giftAmount;

    let clicks = 0;
    let opened = false;

    function microWobble(){
      gift.classList.remove("wobble-1","wobble-2","wobble-3");
      const pick = (clicks % 3) + 1;
      gift.classList.add("wobble-" + pick);
      window.setTimeout(()=> gift.classList.remove("wobble-" + pick), 620);
    }

    function unwrapStep(){
      if(opened) return;
      clicks++;
      microWobble();

      // Subtle, intentional changes across 8‚Äì12 clicks.
      // No counter shown; changes are visual only.
      const total = Math.max(8, Math.min(12, CONFIG.unwrapClicks));
      const t1 = Math.floor(total * 0.45);
      const t2 = Math.floor(total * 0.70);

      if(clicks === 1){
        hint.textContent = "Okay‚Ä¶ slow. Keep going.";
      } else if(clicks === Math.ceil(total*0.25)){
        hint.textContent = "One more gentle tap‚Ä¶ and another.";
      } else if(clicks === t1){
        hint.textContent = "You‚Äôre getting close.";
        bow.classList.add("fade-out");
      } else if(clicks === t2){
        hint.textContent = "Almost there‚Ä¶";
        ribbonV.classList.add("fade-out");
        ribbonH.classList.add("fade-out");
      } else if(clicks >= total){
        opened = true;
        hint.textContent = "Open it.";
        gift.classList.add("open");
        // Reveal postcard after lid begins opening
        window.setTimeout(()=>{
          postcardWrap.classList.add("reveal");
          giftZone.classList.add("dim");
          hint.textContent = "Tap the postcard.";
        }, 420);
        // Disable hit to prevent extra clicks
        hit.style.pointerEvents = "none";
      }
    }

    hit.addEventListener("click", unwrapStep, {passive:true});

    // ---------- Postcard flip ----------
    function toggleFlip(){
      if(!opened) return;
      postcard.classList.toggle("flipped");
      if(postcard.classList.contains("flipped")){
        hint.textContent = "Scratch the card.";
      } else {
        hint.textContent = "Tap to flip.";
      }
    }

    postcard.addEventListener("click", toggleFlip);
    postcard.addEventListener("keydown", (e)=>{
      if(e.key === "Enter" || e.key === " "){
        e.preventDefault();
        toggleFlip();
      }
    });

    // ---------- Scratch-off (canvas destination-out) ----------
    const canvas = document.getElementById("scratchCanvas");
    const scratchZone = document.getElementById("scratchZone");
    const scratchLabel = document.getElementById("scratchLabel");
    const scratchPct = document.getElementById("scratchPct");
    const coin = document.getElementById("coin");
    const confetti = document.getElementById("confetti");

    const ctx = canvas.getContext("2d", { willReadFrequently: true });

    let drawing = false;
    let activePointerId = null;
    let unlocked = false;
    let lastPt = null;
    let scratchStarted = false;

    function sizeCanvas(){
      const rect = scratchZone.getBoundingClientRect();
      const dpr = Math.max(1, Math.min(2, window.devicePixelRatio || 1));
      canvas.width = Math.round(rect.width * dpr);
      canvas.height = Math.round(rect.height * dpr);
      ctx.setTransform(dpr,0,0,dpr,0,0);

      // Cover paint (scratch layer)
      paintCover(rect.width, rect.height);
    }

    function paintCover(w,h){
      // Metallic scratch paint with noise-like streaks (no images)
      const g = ctx.createLinearGradient(0,0,w,h);
      g.addColorStop(0, "rgba(235,235,245,0.98)");
      g.addColorStop(0.45, "rgba(205,205,220,0.98)");
      g.addColorStop(1, "rgba(240,240,250,0.98)");
      ctx.globalCompositeOperation = "source-over";
      ctx.clearRect(0,0,w,h);
      ctx.fillStyle = g;
      ctx.fillRect(0,0,w,h);

      // subtle diagonal sheen
      ctx.globalAlpha = 0.25;
      for(let i=-h; i<w+h; i+=18){
        ctx.fillStyle = (i/18)%2===0 ? "rgba(255,255,255,0.40)" : "rgba(0,0,0,0.12)";
        ctx.fillRect(i, 0, 9, h);
      }
      ctx.globalAlpha = 1;

      // edge vignette
      const vg = ctx.createRadialGradient(w*0.35,h*0.25,10, w*0.5,h*0.5, Math.max(w,h)*0.85);
      vg.addColorStop(0,"rgba(0,0,0,0)");
      vg.addColorStop(1,"rgba(0,0,0,0.22)");
      ctx.fillStyle = vg;
      ctx.fillRect(0,0,w,h);

      // reset amount conceal (until unlock)
      amountText.classList.remove("unlocked");
      unlocked = false;
      scratchLabel.textContent = "Scratch to reveal your gift";
      scratchPct.textContent = "0%";
      confetti.classList.remove("on");
      confetti.innerHTML = "";
      scratchStarted = false;
    }

    function getLocalXY(e){
      const rect = scratchZone.getBoundingClientRect();
      const x = e.clientX - rect.left;
      const y = e.clientY - rect.top;

      // clamp coordinates to bounds (critical to prevent dead zones & drift issues)
      const cx = Math.max(0, Math.min(rect.width, x));
      const cy = Math.max(0, Math.min(rect.height, y));
      return { x: cx, y: cy, w: rect.width, h: rect.height };
    }

    function scratchLine(from, to, radius){
      ctx.globalCompositeOperation = "destination-out";
      ctx.lineCap = "round";
      ctx.lineJoin = "round";
      ctx.strokeStyle = "rgba(0,0,0,1)";
      ctx.lineWidth = radius * 2;
      ctx.beginPath();
      ctx.moveTo(from.x, from.y);
      ctx.lineTo(to.x, to.y);
      ctx.stroke();
    }

    function scratchDot(p, radius){
      ctx.globalCompositeOperation = "destination-out";
      ctx.fillStyle = "rgba(0,0,0,1)";
      ctx.beginPath();
      ctx.arc(p.x, p.y, radius, 0, Math.PI*2);
      ctx.fill();
    }

    function computeScratchedPercent(){
      // Sample pixels for speed (step >1)
      const rect = scratchZone.getBoundingClientRect();
      const w = rect.width;
      const h = rect.height;

      // Read at device pixels? Our context is scaled to css pixels via transform.
      // So read image data at css pixel grid:
      const img = ctx.getImageData(0,0,w,h).data;
      let cleared = 0;
      let total = 0;
      const step = Math.max(4, Math.floor(6 * CONFIG.scratchHardness));
      for(let y=0; y<h; y+=step){
        for(let x=0; x<w; x+=step){
          const idx = (y*w + x) * 4 + 3; // alpha
          total++;
          if(img[idx] < 12) cleared++;
        }
      }
      const pct = total ? (cleared / total) : 0;
      return Math.max(0, Math.min(1, pct));
    }

    let rafPending = false;
    function updateProgress(){
      if(rafPending) return;
      rafPending = true;
      requestAnimationFrame(()=>{
        rafPending = false;
        const pct = computeScratchedPercent();
        const shown = Math.round(pct * 100);
        scratchPct.textContent = shown + "%";

        if(!unlocked && pct >= CONFIG.scratchUnlockThreshold){
          unlocked = true;
          scratchLabel.textContent = "Unlocked üéâ";
          amountText.classList.add("unlocked");
          triggerConfetti();
        }
      });
    }

    function moveCoin(clientX, clientY){
      coin.style.transform = `translate3d(${clientX - 22}px, ${clientY - 22}px, 0)`;
    }

    function showCoin(){ coin.classList.add("show"); }
    function hideCoin(){ coin.classList.remove("show"); }

    function onPointerDown(e){
      if(!postcard.classList.contains("flipped")) return; // only scratch on back
      if(unlocked) return;

      drawing = true;
      activePointerId = e.pointerId;
      lastPt = null;

      // pointer capture (critical bug prevention)
      canvas.setPointerCapture(activePointerId);

      const p = getLocalXY(e);
      scratchDot(p, CONFIG.scratchRadius);
      lastPt = p;
      scratchStarted = true;
      showCoin();
      moveCoin(e.clientX, e.clientY);
      updateProgress();
      e.preventDefault();
    }

    function onPointerMove(e){
      // Always track coin if hovering/touching inside scratch region
      const over = scratchZone.matches(":hover") || drawing;
      if(over){
        showCoin();
        moveCoin(e.clientX, e.clientY);
      } else {
        hideCoin();
      }

      if(!drawing) return;
      if(activePointerId !== e.pointerId) return;

      const p = getLocalXY(e);

      if(lastPt){
        scratchLine(lastPt, p, CONFIG.scratchRadius);
      } else {
        scratchDot(p, CONFIG.scratchRadius);
      }
      lastPt = p;

      updateProgress();
      e.preventDefault();
    }

    function onPointerUp(e){
      if(activePointerId !== e.pointerId) return;

      drawing = false;
      activePointerId = null;
      lastPt = null;

      try{ canvas.releasePointerCapture(e.pointerId); } catch(_){}
      if(!scratchZone.matches(":hover")) hideCoin();

      updateProgress();
      e.preventDefault();
    }

    function onPointerEnter(){
      if(postcard.classList.contains("flipped") && !unlocked) showCoin();
    }
    function onPointerLeave(){
      if(!drawing) hideCoin();
    }

    function triggerConfetti(){
      confetti.classList.add("on");
      confetti.innerHTML = "";
      const pieces = 18;
      for(let i=0;i<pieces;i++){
        const el = document.createElement("i");
        const x = (Math.random()*100 - 50).toFixed(2) + "px";
        el.style.setProperty("--x", x);
        el.style.left = (10 + Math.random()*80) + "%";
        el.style.top = (-10 - Math.random()*30) + "px";
        el.style.animationDelay = (Math.random()*140) + "ms";
        el.style.animationDuration = (900 + Math.random()*500) + "ms";
        el.style.transform = `translate3d(${x}, -20px, 0) rotate(${Math.random()*90}deg)`;
        confetti.appendChild(el);
      }
      window.setTimeout(()=>{
        confetti.classList.remove("on");
      }, 1200);
    }

    // coin should appear only when interacting with scratch zone/back
    scratchZone.addEventListener("pointerenter", onPointerEnter);
    scratchZone.addEventListener("pointerleave", onPointerLeave);

    canvas.addEventListener("pointerdown", onPointerDown);
    canvas.addEventListener("pointermove", onPointerMove);
    canvas.addEventListener("pointerup", onPointerUp);
    canvas.addEventListener("pointercancel", onPointerUp);
    canvas.addEventListener("pointerout", (e)=>{ if(!drawing) hideCoin(); }, {passive:true});

    // Prevent page scroll/zoom gestures while scratching
    canvas.addEventListener("touchstart", (e)=>e.preventDefault(), {passive:false});
    canvas.addEventListener("touchmove", (e)=>e.preventDefault(), {passive:false});

    // Initialize canvas once postcard exists (still ok before reveal)
    sizeCanvas();

    // Resize: re-init only if user hasn't started scratching to avoid wiping progress mid-way
    let resizeTO = null;
    window.addEventListener("resize", ()=>{
      clearTimeout(resizeTO);
      resizeTO = setTimeout(()=>{
        if(!scratchStarted || unlocked){
          sizeCanvas();
        }
      }, 140);
    });

    // Minor UX: if user flips before opening (ignore)
    // Also make sure unwrap clicks stays between 8 and 12
    CONFIG.unwrapClicks = Math.max(8, Math.min(12, CONFIG.unwrapClicks));

    // If user taps anywhere on scratch zone area but misses canvas (still scratch)
    scratchZone.addEventListener("pointerdown", (e)=>{
      if(e.target !== canvas){
        // forward to canvas handler by calling onPointerDown with same event
        onPointerDown(e);
      }
    });

    // Hide coin until needed
    hideCoin();
  </script>
</body>
</html>

